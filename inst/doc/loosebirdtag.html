<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Andrew Burchill" />

<meta name="date" content="2017-10-17" />

<title>Tweaking Coding Schemes: Bird Tagging Example</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Tweaking Coding Schemes: Bird Tagging Example</h1>
<h4 class="author"><em>Andrew Burchill</em></h4>
<h4 class="date"><em>2017-10-17</em></h4>



<div id="the-setup" class="section level1">
<h1>The Setup:</h1>
<p>In this vignette, we will tweak a color coding scheme generated by the <code>reed_solomon()</code> function. In our particular hypothetical situation, we plan on putting color bands around the legs of some bird. We have eight different band colors, and we want to put five bands on each bird: two bands below each of the bird’s “ankles” (around the tarsometatarsus) and one band above the bird’s right “ankle” joint (around the right tibiotarsus). A horrible “graphical” representation can be seen below, where <code>{1}</code>, <code>{2}</code>, <code>{3}</code>, <code>{4}</code>, and <code>{5}</code> refer to the five unique banding positions.</p>
<pre><code>     |   |            |  {5}
     o   o            o   o
     |   |     =&gt;    {1} {3}
     .   .           {2} {4}
    /|\ /|\          /|\ /|\</code></pre>
<p>Let us say that these bands fall off somewhat frequently; we want our coding scheme to be robust to the loss of two bands. If these bands occupy unique positions and can’t be moved around, we can use the <code>reed_solomon()</code> function without further modification.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alphabet &lt;-<span class="st"> </span><span class="dv">8</span>      <span class="co"># the number of colors we have</span>
total.length &lt;-<span class="st"> </span><span class="dv">5</span>  <span class="co"># the number of positions we want band</span>
redundancy &lt;-<span class="st"> </span><span class="dv">2</span>    <span class="co"># how many bands we can lose but still ID perfectly</span>
codes &lt;-<span class="st"> </span>rabi<span class="op">::</span><span class="kw">reed_solomon</span>(total.length, redundancy, alphabet)
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Our list contains &quot;</span>, <span class="kw">length</span>(codes), <span class="st">&quot; unique IDs.&quot;</span>))
<span class="kw">head</span>(codes, <span class="dt">n =</span> 10L)</code></pre></div>
<pre><code>!! Warning in rabi::reed_solomon(total.length, redundancy, alphabet): NOTE:
!! Reed-Solomon codes require the 'alphabet size' (e.g. the number of paint
!! colors you have) to be a prime number. Automatically adjusting to use an
!! alphabet size 7 instead of the entered value of 8.</code></pre>
<pre><code>#&gt; [1] &quot;Our list contains 343 unique IDs.&quot;</code></pre>
<table>
<caption>ID sequences in the unaltered list</caption>
<thead>
<tr class="header">
<th align="center">{1}</th>
<th align="center">{2}</th>
<th align="center">{3}</th>
<th align="center">{4}</th>
<th align="center">{5}</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
<td align="center">2</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">3</td>
<td align="center">3</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">4</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">5</td>
<td align="center">5</td>
<td align="center">5</td>
<td align="center">5</td>
</tr>
<tr class="odd">
<td align="center">6</td>
<td align="center">6</td>
<td align="center">6</td>
<td align="center">6</td>
<td align="center">6</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">5</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">6</td>
</tr>
</tbody>
</table>
<p>Congratualtions! It’s as simple as one line of code. <strong>Note the error: this lets us know that we aren’t getting as much out of <code>reed_solomon()</code> as we could.</strong></p>
</div>
<div id="the-problem" class="section level1">
<h1>The Problem:</h1>
<p>Actually, things aren’t so simple; things get a bit trickier. In reality, these bands may be realtively loose around the legs of the bird. The unique positions of bands <code>{1}</code> and <code>{3}</code> are probably only maintained due to the physical presence of bands <code>{2}</code> and <code>{4}</code>. If <code>{2}</code> or <code>{4}</code> were to somehow be removed, the band above them would succumb to gravity and descend into the newly vacated position. In the below “diagram,” we see that a loss of both <code>{1}</code> and <code>{2}</code> will yield the same final configuration. In this case, it would be impossible to tell the original position of the remaining band.</p>
<pre><code>     |  {5}           |  {5}           |  {5}
     o   o            o   o            o   o
    {1} {3}   AND     x  {3}    =&gt;     |  {3}
     x  {4}          {2} {4}          {?} {4}
    /|\ /|\          /|\ /|\          /|\ /|\</code></pre>
<p>It becomes clear that a loss in <code>{1}</code> would make the ID code <strong>3,4</strong>,2,4,0 indistinguishable from <strong>4,3</strong>,2,4,0 or <strong>5,3</strong>,2,4,0 or <strong>3,0</strong>,2,4,0 etc. (A similar dilemna is caused by losses in <code>{3}</code> or <code>{4}</code>.) The generated codes can still totally correct for a <em>single</em> erasure anywhere, but accounting for both an erasure AND an uncertain position “costs” the same as a double erasure. So if one erasure happens between <code>{1}</code> and <code>{2}</code> and a second erasure happens between <code>{3}</code> and <code>{4}</code>, we would need the code to be robust to FOUR erasures, which would render it quite useless.</p>
<p>The best fix for this is not easily apparent. Let’s first try to work around it just by manipulating our coding scheme.</p>
</div>
<div id="some-solutions" class="section level1">
<h1>Some Solutions:</h1>
<div id="pruning-the-coding-list" class="section level2">
<h2>Pruning the coding list</h2>
<p>One possible idea: prune the list of codes so that the top bands, <code>{1}</code> and <code>{3}</code>, are only odd numbers and the bottom bands, <code>{2}</code> and <code>{4}</code>, are only even numbers. That way, a lone even-numbered band indicates that the upper band has been lost, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co">#create a function for determining odd or even</span>
odd &lt;-<span class="st"> </span><span class="cf">function</span>(x){ x <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span> }
 <span class="co">#turn the code list into a matrix for easier manipulation</span>
codes &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">do.call</span>(<span class="st">&quot;cbind&quot;</span>,codes)) 
 <span class="co">#only select the codes where {1} and {3} are odd, and {2} and {4} are even</span>
codes &lt;-<span class="st"> </span>
<span class="st">  </span>codes[<span class="kw">which</span>(<span class="kw">odd</span>(codes[,<span class="dv">1</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="kw">odd</span>(codes[,<span class="dv">3</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(codes[,<span class="dv">2</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(codes[,<span class="dv">4</span>])), ]
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;Our new list contains &quot;</span>, <span class="kw">dim</span>(codes)[<span class="dv">1</span>], <span class="st">&quot; unique IDs.&quot;</span>))</code></pre></div>
<pre><code>#&gt; [1] &quot;Our new list contains 22 unique IDs.&quot;</code></pre>
<p>Damn. That’s almost nothing…</p>
<div id="using-the-tweaker-function" class="section level3">
<h3>Using the <code>tweaker()</code> function</h3>
<p>However, we can possibly increase that number by using the <code>tweaker()</code> function. It’s the same as <code>brute_IDs()</code>, but instead of pruning down a list of ALL possible ID sequences, we can specify our constraints first and then generate that list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co">#create a matrix of all possible sequences</span>
perms &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="kw">list</span>(<span class="kw">seq_len</span>(alphabet)),total.length)
combos &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">expand.grid</span>(perms)) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
 <span class="co">#only keep sequences that fit our constraints</span>
combos1 &lt;-<span class="st"> </span>
<span class="st">  </span>combos[<span class="kw">which</span>(<span class="kw">odd</span>(combos[,<span class="dv">1</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="kw">odd</span>(combos[,<span class="dv">3</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">2</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">4</span>])), ]
codes &lt;-<span class="st"> </span>rabi<span class="op">::</span><span class="kw">tweaker</span>(combos1, redundancy, <span class="dt">num.tries =</span> <span class="dv">1</span>)  <span class="co">#we're only running it once for speed</span>
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;The 'tweaked' list contains &quot;</span>, <span class="kw">length</span>(codes), <span class="st">&quot; unique IDs.&quot;</span>))</code></pre></div>
<pre><code>#&gt; [1] &quot;The 'tweaked' list contains 45 unique IDs.&quot;</code></pre>
<p>Okay, that’s still not much better…</p>
</div>
</div>
<div id="using-empty-spaces" class="section level2">
<h2>Using empty spaces</h2>
<p>Still not good enough? Perhaps you find it annoying that the top bands can only be odd. Perhaps we could get more IDs if we weren’t so constrained. To further add IDs, we could have the top and bottom bands merely be opposites in terms of oddness or evenness. For example, if <code>{3}</code> is even, <code>{4}</code> is odd; if <code>{3}</code> is odd, <code>{4}</code> is even. But how could we indicate to the observer which level is even and which is odd?</p>
<p>Well, although <code>{5}</code> is around the right tibiotarsus, there is an unused spot around the left tibiotarsus. If we allow <code>{5}</code> to occupy either position (see below), we can encode a bit more information in the ID sequence.</p>
<pre><code>     |  {5}          {5}  |
     o   o            o   o
    {1} {3}    OR    {1} {3}
    {2} {4}          {2} {4}
    /|\ /|\          /|\ /|\</code></pre>
<p>We can arbitrarily say that when <code>{5}</code> is on the right leg, the top bands <code>{1}</code> and <code>{3}</code> are odd. When <code>{5}</code> is on the left side, the top bands <code>{1}</code> and <code>{3}</code> are even. However, if <code>{5}</code> fell off, we might think that this information is lost. Not so! Imagine that <code>{5}</code> and <code>{3}</code> fell off: we can reconstruct both <code>{5}</code>’s position and <code>{3}</code>’s “oddness”&quot; by looking at <code>{1}</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co">#only select sequences where the top and bottom bands differ in &quot;oddness&quot;</span>
combos2 &lt;-<span class="st"> </span>combos[<span class="kw">which</span>((
      (<span class="kw">odd</span>(combos[,<span class="dv">1</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="kw">odd</span>(combos[,<span class="dv">3</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">2</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">4</span>])) <span class="op">|</span>
<span class="st">      </span>(<span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">1</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">3</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="kw">odd</span>(combos[,<span class="dv">2</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="kw">odd</span>(combos[,<span class="dv">4</span>]))
      )), ]
codes &lt;-<span class="st"> </span>rabi<span class="op">::</span><span class="kw">tweaker</span>(combos2, redundancy, <span class="dt">num.tries =</span> <span class="dv">1</span>)  <span class="co">#we're only running it once for speed</span>
 <span class="co">#add either a &quot;left&quot; or &quot;right&quot; indicating which leg {5} is on</span>
codes &lt;-<span class="st"> </span><span class="kw">lapply</span>(codes, <span class="cf">function</span>(x) <span class="cf">if</span>(<span class="kw">odd</span>(x[[<span class="dv">1</span>]])) {<span class="kw">append</span>(x,<span class="st">&quot;R&quot;</span>)} <span class="cf">else</span> {<span class="kw">append</span>(x,<span class="st">&quot;L&quot;</span>)})
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;The 'tweaked' list contains &quot;</span>, <span class="kw">length</span>(codes), <span class="st">&quot; unique IDs.&quot;</span>))
<span class="kw">head</span>(codes, <span class="dt">n =</span> 10L)</code></pre></div>
<pre><code>#&gt; [1] &quot;The 'tweaked' list contains 87 unique IDs.&quot;</code></pre>
<table>
<caption>ID sequences in variable position list</caption>
<thead>
<tr class="header">
<th align="center">{1}</th>
<th align="center">{2}</th>
<th align="center">{3}</th>
<th align="center">{4}</th>
<th align="center">{5}</th>
<th align="center">{5}’s Position</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">4</td>
<td align="center">3</td>
<td align="center">2</td>
<td align="center">7</td>
<td align="center">7</td>
<td align="center">L</td>
</tr>
<tr class="even">
<td align="center">7</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">6</td>
<td align="center">4</td>
<td align="center">R</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">2</td>
<td align="center">L</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">L</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">2</td>
<td align="center">5</td>
<td align="center">6</td>
<td align="center">1</td>
<td align="center">R</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">6</td>
<td align="center">6</td>
<td align="center">R</td>
</tr>
<tr class="odd">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">7</td>
<td align="center">2</td>
<td align="center">L</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">5</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">4</td>
<td align="center">L</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">5</td>
<td align="center">4</td>
<td align="center">5</td>
<td align="center">R</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">4</td>
<td align="center">3</td>
<td align="center">R</td>
</tr>
</tbody>
</table>
<p>Although this is the best so far, to really make this work we’ll probably need to further change the physical setup of the tagging system.</p>
</div>
<div id="removing-ambiguity" class="section level2">
<h2>Removing ambiguity</h2>
<p>If we consider the option of physically altering the setup, we find a very simple solution: on the upper color bands <code>{1}</code> and <code>{3}</code>, add some sort of dark, high-contrast mark. Perhaps something as simple as darkening the upper half of these bands with a sharpie would work. Adding additional markings to the bands can give the banding positions uniqueness in the face of gravity and detachment. However, this class of solutions is very dependant on your situation.</p>
<p>Barring something this simplistic, we could move <code>{1}</code> up above the “ankle” and around the left tibiotarsus. Now only <code>{3}</code> and <code>{4}</code> share a confusable position. The new arrangement would look something like this:</p>
<pre><code>     |  {5}          {1} {5}
     o   o            o   o
    {1} {3}    =&gt;     |  {3}
    {2} {4}          {2} {4}
    /|\ /|\          /|\ /|\</code></pre>
<p>Our code:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="co">#now, only {3} and {4} need to be constrained as odd and even, respectively</span>
combos3 &lt;-<span class="st"> </span>
<span class="st">  </span>combos[<span class="kw">which</span>(<span class="kw">odd</span>(combos[,<span class="dv">3</span>]) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">odd</span>(combos[,<span class="dv">4</span>])), ]
codes &lt;-<span class="st"> </span>rabi<span class="op">::</span><span class="kw">tweaker</span>(combos3, redundancy, <span class="dt">num.tries =</span> <span class="dv">1</span>)  <span class="co">#we're only running it once for speed</span>
<span class="kw">print</span>(<span class="kw">paste0</span>(<span class="st">&quot;This last list contains &quot;</span>, <span class="kw">length</span>(codes), <span class="st">&quot; unique IDs.&quot;</span>))</code></pre></div>
<pre><code>#&gt; [1] &quot;This last list contains 99 unique IDs.&quot;</code></pre>
<p>There are many, many other ways to tweak both the tagging setup and the code list. I’m sure many of them could generate even more unique IDs than the ways I’ve outlined above. However, it’s important to keep in mind that the functions in <code>rabi</code> ASSUME there is no weird uncertainty and sliding around of banding positions. If you are going to use these functions to help create codes for your own weird situation, I would make sure you write up a function that properly tests your lists to verify they are appropriately robust.</p>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
